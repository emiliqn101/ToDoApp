<!DOCTYPE html>
<html>
<head>
    <title>To Do List</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .taskContainer {
            background-color: #333;
            color: white;
            padding: 10px;
            margin-bottom: 10px;
            width: 300px;
            margin: 5px auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Add styles for completed tasks */
        .completedTask {
            opacity: 0.6; /* Reduced opacity for completed tasks */
            text-decoration: line-through; /* Strikethrough for completed tasks */
        }

        .taskCheckbox {
            margin-right: 10px; /* Add some margin to separate checkbox and text */
        }

        .deleteButton {
            background-color: #ff3333; /* Red color for delete button */
            color: white;
            padding: 5px 10px;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div style="text-align: center;">
        <h3>To Do</h3>
        <form id="taskForm">
            {% csrf_token %} <!-- Include the CSRF token -->
            <input type="text" id="taskName" placeholder="Enter Task">
            <button type="button" id="addTask">Add Task</button>
        </form>
        <div id="taskList">
            {% for task in tasks %}
                <div class="taskContainer {% if task.complete %}completedTask{% endif %}">
                    <label>
                        <input type="checkbox" class="taskCheckbox" data-taskname="{{ task.title }}" {% if task.complete %}checked{% endif %}>
                        <span>{{ task.title }}</span>
                    </label>
                    <button class="deleteButton" data-taskname="{{ task.title }}">Delete</button>
                </div>
            {% endfor %}
        </div>
    </div>

    <script>
        $(document).ready(function () {
            // Event handler for checkbox changes
            $(".taskCheckbox").change(function () {
                var taskName = $(this).data("taskname");
                var completed = $(this).is(":checked");

                // Make a POST request to update the task state
                $.ajax({
                    url: "/update_task/",  // Replace with your target URL
                    type: "POST",
                    data: {
                        taskname: taskName,
                        completed: completed ? "true" : "false",
                        csrfmiddlewaretoken: $("input[name='csrfmiddlewaretoken']").val(),
                    },
                    success: function (data) {
                        // Handle the response here, if needed
                        console.log(data.message);
                        // Toggle the completedTask class for styling
                        $(this).closest(".taskContainer").toggleClass("completedTask", completed);
                        location.reload();
                    },
                    error: function (error) {
                        console.error(error);
                        alert("An error occurred while updating the task state.");
                    }
                });
            });

            // Event handler for adding tasks
            $("#addTask").click(function () {
                var taskName = $("#taskName").val();

                // Perform basic validation (non-empty task name)
                if (taskName.trim() === "") {
                    alert("Task name cannot be empty.");
                    return;
                }

                // Include the CSRF token
                var csrftoken = $("[name=csrfmiddlewaretoken]").val();

                // Make a POST request to create the task
                $.ajax({
                    url: "/create_task/",  // Replace with your target URL
                    type: "POST",
                    data: {
                        task_name: taskName,
                        csrfmiddlewaretoken: csrftoken,
                    },
                    success: function (data) {
                        // Handle the response here, if needed
                        console.log(data.message);
                        // You can update the taskList div or perform other actions
                        // For example, you can clear the input field
                        $("#taskName").val("");
                        location.reload();
                    },
                    error: function (error) {
                        console.error(error);
                        alert("An error occurred while adding the task.");
                    }
                });
            });
            $(".deleteButton").click(function () {
                var taskName = $(this).data("taskname");
            
                // Include the CSRF token
                var csrftoken = $("[name=csrfmiddlewaretoken]").val();
            
                // Make a POST request to delete the task
                $.ajax({
                    url: "/delete_task/",  // Replace with your target URL
                    type: "POST",
                    data: {
                        taskname: taskName,
                        csrfmiddlewaretoken: csrftoken,
                    },
                    success: function (data) {
                        // Handle the response here, if needed
                        console.log(data.message);
                        // You can update the taskList div or perform other actions
                        // For example, you can clear the input field
                        location.reload();
                    },
                    error: function (error) {
                        console.error(error);
                        alert("An error occurred while deleting the task.");
                    }
                });
            });
            
        });
    </script>
</body>
</html>
